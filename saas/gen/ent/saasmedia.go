// Code generated by ent, DO NOT EDIT.

package ent

import (
	"context"
	"fmt"
	"saas/gen/ent/mediable"

	"entgo.io/ent"
)

type SaveMediaProp struct {
	Tag            string
	Order          int
	AppID          string
	MediableType   string
	MediableID     string
	AddMediaIDs    []string
	RemoveMediaIDs []string
	Cleared        bool
}

func SaveMedia(client *Client, props *SaveMediaProp) {
	ctx := context.Background()

	if props.Cleared {
		client.Mediable.Delete().Where(mediable.AppID(props.AppID), mediable.MediableType(props.MediableType), mediable.MediableID(props.MediableID)).Exec(ctx)
	}

	if props.RemoveMediaIDs != nil {
		client.Mediable.Delete().Where(mediable.AppID(props.AppID), mediable.MediableType(props.MediableType), mediable.MediableID(props.MediableID), mediable.MediaIDIn(props.RemoveMediaIDs...)).Exec(ctx)
	}

	if props.AddMediaIDs != nil {
		for _, mediaID := range props.AddMediaIDs {
			client.Mediable.Create().
				SetAppID(props.AppID).
				SetTag(props.Tag).
				SetOrder(0).
				SetMediableType(props.MediableType).
				SetMediableID(props.MediableID).
				SetMediaID(mediaID).
				Save(ctx)
		}
	}
}

func PostClientMediaHook() func(next ent.Mutator) ent.Mutator {
	return func(next ent.Mutator) ent.Mutator {
		return ent.MutateFunc(func(ctx context.Context, m ent.Mutation) (ent.Value, error) {
			fmt.Printf("Type11: %s, Operation: %s, ConcreteType: %T\n", m.Type(), m.Op(), m)

			if s, ok := m.(*PostMutation); ok {
				{
					id, _ := s.ID()

					saveMediaProp := SaveMediaProp{
						Tag:            "featured",
						Order:          0,
						AppID:          "a2",
						MediableType:   "posts",
						MediableID:     id,
						AddMediaIDs:    s.FeaturedMediaIDs(),
						RemoveMediaIDs: s.RemovedFeaturedMediaIDs(),
						Cleared:        s.FeaturedMediasCleared(),
					}
					fmt.Println(saveMediaProp)

					SaveMedia(s.Client(), &saveMediaProp)

				}
				{
					id, _ := s.ID()

					saveMediaProp := SaveMediaProp{
						Tag:            "icon",
						Order:          0,
						AppID:          "a2",
						MediableType:   "posts",
						MediableID:     id,
						AddMediaIDs:    s.IconMediaIDs(),
						RemoveMediaIDs: s.RemovedIconMediaIDs(),
						Cleared:        s.IconMediasCleared(),
					}
					fmt.Println(saveMediaProp)

					SaveMedia(s.Client(), &saveMediaProp)

				}
			}
			return next.Mutate(ctx, m)
		})
	}
}

func (m *PostMutation) AddFeaturedMediaIDs(ids ...string) {
	if m.featured_medias == nil {
		m.featured_medias = make(map[string]struct{})
	}
	for i := range ids {
		m.featured_medias[ids[i]] = struct{}{}
	}
}

func (m *PostMutation) ClearFeaturedMedias() {
	m.clearedfeatured_medias = true
}

func (m *PostMutation) FeaturedMediasCleared() bool {
	return m.clearedfeatured_medias
}

func (m *PostMutation) RemoveFeaturedMediaIDs(ids ...string) {
	if m.removedfeatured_medias == nil {
		m.removedfeatured_medias = make(map[string]struct{})
	}
	for i := range ids {
		delete(m.featured_medias, ids[i])
		m.removedfeatured_medias[ids[i]] = struct{}{}
	}
}

func (m *PostMutation) RemovedFeaturedMediaIDs() (ids []string) {
	for id := range m.removedfeatured_medias {
		ids = append(ids, id)
	}
	return
}

func (m *PostMutation) FeaturedMediaIDs() (ids []string) {
	for id := range m.featured_medias {
		ids = append(ids, id)
	}
	return
}

func (m *PostMutation) ResetFeaturedMedias() {
	m.featured_medias = nil
	m.clearedfeatured_medias = false
	m.removedfeatured_medias = nil
}

func (m *PostMutation) AddIconMediaIDs(ids ...string) {
	if m.icon_medias == nil {
		m.icon_medias = make(map[string]struct{})
	}
	for i := range ids {
		m.icon_medias[ids[i]] = struct{}{}
	}
}

func (m *PostMutation) ClearIconMedias() {
	m.clearedicon_medias = true
}

func (m *PostMutation) IconMediasCleared() bool {
	return m.clearedicon_medias
}

func (m *PostMutation) RemoveIconMediaIDs(ids ...string) {
	if m.removedicon_medias == nil {
		m.removedicon_medias = make(map[string]struct{})
	}
	for i := range ids {
		delete(m.icon_medias, ids[i])
		m.removedicon_medias[ids[i]] = struct{}{}
	}
}

func (m *PostMutation) RemovedIconMediaIDs() (ids []string) {
	for id := range m.removedicon_medias {
		ids = append(ids, id)
	}
	return
}

func (m *PostMutation) IconMediaIDs() (ids []string) {
	for id := range m.icon_medias {
		ids = append(ids, id)
	}
	return
}

func (m *PostMutation) ResetIconMedias() {
	m.icon_medias = nil
	m.clearedicon_medias = false
	m.removedicon_medias = nil
}
